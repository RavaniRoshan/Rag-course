<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Code View - Academic RAG Journal</title>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&amp;family=Inter:wght@400;500;600;700;800&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "bg": "#0E0E10",
                        "bg-secondary": "#18181B",
                        "border": "#27272A",
                        "foreground": "#FAFAFA",
                        "muted": "#A1A1AA",
                        "accent": "#3ECF8E",
                        "accent-secondary": "#24A472",
                        "accent-foreground": "#0E0E10",
                    },
                    fontFamily: {
                        "sans": ["Inter", "sans-serif"],
                        "mono": ["JetBrains Mono", "monospace"],
                    },
                    backdropBlur: {
                        'xl': '24px',
                    }
                },
            },
        }
    </script>
<style>
        body {
            font-feature-settings: "cv11", "ss01";
            -webkit-font-smoothing: antialiased;
        }
        .brutal-border { border: 2px solid #27272A; }
        .brutal-border-accent { border: 2px solid #3ECF8E; }
        .btn-brutal { transition: all 0.15s ease-out; }
        .btn-brutal:hover {
            transform: translate(-2px, -2px);
            box-shadow: 4px 4px 0px 0px #3ECF8E;
        }
        .brutal-shadow-hover:hover {
            box-shadow: 6px 6px 0px 0px #3ECF8E;
            transform: translate(-2px, -2px);
        }
        .glass-nav {
            background: rgba(14, 14, 16, 0.6);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border-bottom: 1px solid rgba(39, 39, 42, 0.5);
        }
        .modal-overlay {
            background: rgba(14, 14, 16, 0.8);
            backdrop-filter: blur(4px);
        }
        .code-line {
            counter-increment: line;
            position: relative;
            padding-left: 3rem;
        }
        .code-line::before {
            content: counter(line);
            position: absolute;
            left: 0.5rem;
            width: 2rem;
            text-align: right;
            color: #3f3f46;
            font-size: 0.75rem;
        }
        .token.keyword { color: #3ECF8E; }
        .token.class-name { color: #FAFAFA; }
        .token.function { color: #3ECF8E; }
        .token.string { color: #F59E0B; }
        .token.comment { color: #71717A; font-style: italic; }
        .token.operator { color: #A1A1AA; }
        .token.number { color: #3ECF8E; }
    </style>
</head>
<body class="bg-bg text-foreground font-sans min-h-screen flex flex-col">

<!-- Glassmorphism Navbar -->
<nav class="sticky top-0 z-40 w-full border-b border-border/50 bg-bg/60 backdrop-blur-xl px-6 py-4 glass-nav">
<div class="max-w-7xl mx-auto flex items-center justify-between">
<div class="flex items-center gap-3">
<a href="index.html" class="flex items-center gap-3">
<span class="material-symbols-outlined text-accent text-2xl">menu_book</span>
<h2 class="font-sans font-bold text-xl tracking-tight text-foreground">Academic RAG Journal</h2>
</a>
</div>
<div class="flex items-center gap-6">
<a class="font-mono text-xs uppercase tracking-wider text-muted hover:text-accent transition-colors" href="about.html">About</a>
<button class="bg-accent text-accent-foreground font-mono text-xs uppercase tracking-wider px-6 py-2 brutal-border brutal-shadow-hover btn-brutal" onclick="openSubscribeModal()">
                Subscribe
            </button>
</div>
</div>
</nav>

<!-- Main Content -->
<main class="flex-1 w-full max-w-7xl mx-auto px-6 py-12">
<!-- Header -->
<header class="mb-8">
<div class="flex items-center gap-4 mb-6">
<a href="module_01_reranking.html" class="flex items-center gap-2 text-muted hover:text-accent transition-colors">
<span class="material-symbols-outlined">arrow_back</span>
<span class="font-mono text-xs uppercase">Back to Module</span>
</a>
</div>
<h1 class="font-sans text-3xl font-bold text-foreground mb-2">Reranker Implementation</h1>
<p class="font-mono text-sm text-muted">Complete code example for contextual reranking pipeline</p>
</header>

<!-- Code Container -->
<div class="brutal-border bg-bg-secondary overflow-hidden">
<!-- Toolbar -->
<div class="flex items-center justify-between px-4 py-3 border-b border-border bg-bg/50">
<span class="font-mono text-sm text-foreground font-bold">reranker_pipeline.py</span>
<div class="flex gap-2">
<button class="p-2 text-muted hover:text-accent transition-colors" onclick="copyCode()" title="Copy">
<span class="material-symbols-outlined text-lg">content_copy</span>
</button>
</div>
</div>

<!-- Code -->
<div class="p-6 overflow-x-auto">
<pre class="font-mono text-sm leading-7"><code class="language-python block">
<span class="code-line"><span class="token keyword">from</span> typing <span class="token keyword">import</span> List, Dict, Any</span>
<span class="code-line"><span class="token keyword">import</span> torch</span>
<span class="code-line"><span class="token keyword">from</span> sentence_transformers <span class="token keyword">import</span> CrossEncoder</span>
<span class="code-line"></span>
<span class="code-line"><span class="token keyword">class</span> <span class="token class-name">ContextualReranker</span>:</span>
<span class="code-line">    <span class="token string">"""Cross-encoder based reranker for retrieved documents."""</span></span>
<span class="code-line">    </span>
<span class="code-line">    <span class="token keyword">def</span> <span class="token function">__init__</span>(self, model_name: str = <span class="token string">"cross-encoder/ms-marco-MiniLM-L-6-v2"</span>):</span>
<span class="code-line">        self.device <span class="token operator">=</span> <span class="token string">"cuda"</span> <span class="token keyword">if</span> torch.cuda.is_available() <span class="token keyword">else</span> <span class="token string">"cpu"</span></span>
<span class="code-line">        self.model <span class="token operator">=</span> CrossEncoder(model_name, device=self.device)</span>
<span class="code-line">        <span class="token keyword">print</span>(f<span class="token string">"Loaded reranker on {self.device}"</span>)</span>
<span class="code-line"></span>
<span class="code-line">    <span class="token keyword">def</span> <span class="token function">rank</span>(self, query: str, docs: List[str], top_k: int = <span class="token number">5</span>) <span class="token operator">-&gt;</span> List[Dict]:</span>
<span class="code-line">        <span class="token string">"""Rerank documents based on query relevance."""</span></span>
<span class="code-line">        <span class="token keyword">if</span> <span class="token keyword">not</span> docs:</span>
<span class="code-line">            <span class="token keyword">return</span> []</span>
<span class="code-line">        </span>
<span class="code-line">        <span class="token comment"># Create query-document pairs</span></span>
<span class="code-line">        pairs <span class="token operator">=</span> [[query, doc] <span class="token keyword">for</span> doc <span class="token keyword">in</span> docs]</span>
<span class="code-line">        </span>
<span class="code-line">        <span class="token comment"># Get relevance scores</span></span>
<span class="code-line">        scores <span class="token operator">=</span> self.model.predict(pairs)</span>
<span class="code-line">        </span>
<span class="code-line">        <span class="token comment"># Sort by score</span></span>
<span class="code-line">        results <span class="token operator">=</span> sorted(</span>
<span class="code-line">            [(docs[i], float(scores[i])) <span class="token keyword">for</span> i <span class="token keyword">in</span> range(len(docs))],</span>
<span class="code-line">            key<span class="token operator">=</span><span class="token keyword">lambda</span> x: x[<span class="token number">1</span>],</span>
<span class="code-line">            reverse<span class="token operator">=</span><span class="token keyword">True</span></span>
<span class="code-line">        )</span>
<span class="code-line">        </span>
<span class="code-line">        <span class="token keyword">return</span> [{<span class="token string">"text"</span>: t, <span class="token string">"score"</span>: s} <span class="token keyword">for</span> t, s <span class="token keyword">in</span> results[:top_k]]</span>
<span class="code-line"></span>
<span class="code-line"><span class="token comment"># Usage</span></span>
<span class="code-line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span>:</span>
<span class="code-line">    reranker <span class="token operator">=</span> ContextualReranker()</span>
<span class="code-line">    docs <span class="token operator">=</span> [</span>
<span class="code-line">        <span class="token string">"Paris is the capital of France."</span>,</span>
<span class="code-line">        <span class="token string">"Berlin is the capital of Germany."</span></span>
<span class="code-line">    ]</span>
<span class="code-line">    results <span class="token operator">=</span> reranker.rank(<span class="token string">"France capital"</span>, docs)</span>
<span class="code-line">    <span class="token keyword">print</span>(results)</span>
</code></pre>
</div>
</div>

<!-- Info Section -->
<div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
<div class="brutal-border bg-bg-secondary p-6">
<h3 class="font-sans font-bold text-foreground mb-3 flex items-center gap-2">
<span class="material-symbols-outlined text-accent">info</span>
                    How It Works
                </h3>
<p class="font-sans text-muted text-sm leading-relaxed">
                    Cross-encoders process query and document together, producing more accurate relevance scores than bi-encoders. Use this to rerank top 50-100 results from initial retrieval.
                </p>
</div>
<div class="brutal-border bg-bg-secondary p-6">
<h3 class="font-sans font-bold text-foreground mb-3 flex items-center gap-2">
<span class="material-symbols-outlined text-accent">speed</span>
                    Performance
                </h3>
<p class="font-sans text-muted text-sm leading-relaxed">
                    Cross-encoders are slower than bi-encoders but more accurate. Best used as a second-stage reranker on a small candidate set (50-100 documents).
                </p>
</div>
</div>
</main>

<!-- Subscribe Modal -->
<div id="subscribe-modal" class="fixed inset-0 z-50 hidden">
<div class="modal-overlay absolute inset-0" onclick="closeSubscribeModal()"></div>
<div class="flex items-center justify-center min-h-screen p-4">
<div class="modal-content relative bg-bg-secondary brutal-border p-8 w-full max-w-md">
<button class="absolute top-4 right-4 text-muted hover:text-foreground" onclick="closeSubscribeModal()">
<span class="material-symbols-outlined">close</span>
</button>
<h2 class="font-sans text-2xl font-bold text-foreground mb-2">Subscribe to Access</h2>
<p class="font-mono text-xs text-muted mb-6">Enter your email to get full access to all 15 modules</p>
<form id="subscribe-form" onsubmit="handleSubscribe(event)">
<div class="mb-6">
<label class="block font-mono text-xs text-muted mb-2 uppercase">Email Address</label>
<input type="email" id="subscribe-email" required class="w-full bg-bg brutal-border px-4 py-3 text-foreground font-mono text-sm focus:outline-none focus:border-accent" placeholder="you@example.com"/>
</div>
<div class="mb-6">
<label class="flex items-start gap-3 cursor-pointer">
<input type="checkbox" id="marketing-consent" class="mt-1 accent-accent"/>
<span class="font-mono text-xs text-muted">I agree to receive marketing emails about new courses and products.</span>
</label>
</div>
<button type="submit" class="w-full bg-accent text-accent-foreground font-mono text-sm uppercase tracking-wider py-3 brutal-border brutal-shadow-hover btn-brutal">
                Get Full Access
            </button>
</form>
</div>
</div>
</div>

<script>
const SUBSCRIPTION_KEY = 'rag_journal_subscribed';

function isSubscribed() {
    return localStorage.getItem(SUBSCRIPTION_KEY) === 'true';
}

function setSubscription(email) {
    localStorage.setItem(SUBSCRIPTION_KEY, 'true');
    localStorage.setItem('rag_journal_email', email);
}

function openSubscribeModal() {
    if (isSubscribed()) {
        if (confirm('Already subscribed. Reset?')) {
            localStorage.removeItem(SUBSCRIPTION_KEY);
        } else return;
    }
    document.getElementById('subscribe-modal').classList.remove('hidden');
}

function closeSubscribeModal() {
    document.getElementById('subscribe-modal').classList.add('hidden');
}

function handleSubscribe(event) {
    event.preventDefault();
    const email = document.getElementById('subscribe-email').value;
    const consent = document.getElementById('marketing-consent').checked;
    setSubscription(email);
    if (consent) localStorage.setItem('marketing_consent', 'true');
    closeSubscribeModal();
    alert('Welcome! Full access granted.');
    window.location.reload();
}

function copyCode() {
    const code = document.querySelector('pre code').innerText;
    navigator.clipboard.writeText(code);
    alert('Code copied!');
}

document.addEventListener('DOMContentLoaded', function() {
    if (!isSubscribed()) {
        setTimeout(() => openSubscribeModal(), 500);
    }
    document.addEventListener('keydown', e => {
        if (e.key === 'Escape') closeSubscribeModal();
    });
});
</script>
</body>
</html>

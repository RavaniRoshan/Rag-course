<!DOCTYPE html>

<html lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Academic RAG Journal - Module 01: Reranking Strategies</title>
<!-- Fonts -->
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&amp;family=Inter:wght@400;500;600;700;800&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&amp;family=Inter:wght@400;500;600;700;800&amp;display=swap" rel="stylesheet"/>
<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries,typography"></script>
<!-- Theme Config -->
<script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "bg": "#0E0E10",
                        "bg-secondary": "#18181B",
                        "border": "#27272A",
                        "foreground": "#FAFAFA",
                        "muted": "#A1A1AA",
                        "accent": "#3ECF8E",
                        "accent-secondary": "#24A472",
                        "accent-foreground": "#0E0E10",
                        "destructive": "#C92A2A",
                        "warning": "#F59E0B",
                        "info": "#3B82F6",
                    },
                    fontFamily: {
                        "sans": ["Inter", "sans-serif"],
                        "mono": ["JetBrains Mono", "monospace"],
                    },
                    boxShadow: {
                        'brutal': '4px 4px 0px 0px rgba(62, 207, 142, 0.3)',
                        'brutal-lg': '6px 6px 0px 0px rgba(62, 207, 142, 0.4)',
                    }
                },
            },
        }
    </script>
<style>
        body {
            font-feature-settings: "cv11", "ss01";
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .brutal-border {
            border: 2px solid #27272A;
        }

        .brutal-border-accent {
            border: 2px solid #3ECF8E;
        }

        .brutal-shadow-hover:hover {
            box-shadow: 6px 6px 0px 0px #3ECF8E;
            transform: translate(-2px, -2px);
        }

        .btn-brutal {
            transition: all 0.15s ease-out;
        }

        .btn-brutal:hover {
            transform: translate(-2px, -2px);
            box-shadow: 4px 4px 0px 0px #3ECF8E;
        }

        .btn-brutal:active {
            transform: translate(2px, 2px);
            box-shadow: 0px 0px 0px 0px #3ECF8E;
        }

        .modal-overlay {
            background: rgba(14, 14, 16, 0.8);
            backdrop-filter: blur(4px);
        }

        .modal-content {
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Fix overlapping elements */
        .prose h1, .prose h2, .prose h3 {
            margin-top: 1.5em;
            margin-bottom: 0.75em;
            line-height: 1.3;
        }

        .prose p {
            margin-top: 1em;
            margin-bottom: 1em;
            line-height: 1.8;
        }

        .prose pre {
            margin-top: 1.5em;
            margin-bottom: 1.5em;
            overflow-x: auto;
        }

        .prose code {
            word-wrap: break-word;
            white-space: pre-wrap;
        }

        .prose ul, .prose ol {
            margin-top: 0.75em;
            margin-bottom: 0.75em;
            padding-left: 1.5em;
        }

        .prose li {
            margin-top: 0.5em;
            margin-bottom: 0.5em;
        }

        /* Responsive fixes */
        @media (max-width: 768px) {
            .prose h1 { font-size: 1.75rem; }
            .prose h2 { font-size: 1.5rem; }
            .prose p { font-size: 0.95rem; }
        }
    </style>
</head>
<body class="bg-bg text-foreground antialiased selection:bg-primary/20 selection:text-foreground min-h-screen flex flex-col font-serif relative">
<!-- Grain Texture Overlay -->
<div class="fixed inset-0 pointer-events-none z-50 bg-grain mix-blend-multiply opacity-40"></div>
<!-- Top Navigation (Minimal) -->
<header class="sticky top-0 z-40 w-full border-b border-border bg-bg-secondary/95 backdrop-blur-sm h-14 flex items-center justify-between px-6 lg:px-10">
<div class="flex items-center gap-4">
<a class="flex items-center gap-2 text-foreground hover:text-accent transition-colors group" href="index.html">
<span class="material-symbols-outlined text-[20px] group-hover:-translate-x-1 transition-transform">arrow_back</span>
<span class="font-display font-medium text-lg tracking-tight">Syllabus</span>
</a>
<div class="h-4 w-px bg-faded mx-2"></div>
<span class="font-mono text-xs uppercase tracking-wider text-muted">Module 01</span>
</div>
<div class="flex items-center gap-6">
<div class="hidden md:flex items-center gap-2 text-muted text-xs font-mono">
<span class="material-symbols-outlined text-[16px]">schedule</span>
<span id="reading-time">45 min read</span>
</div>
<div class="flex gap-3">
<button id="search-btn" aria-label="Search" class="flex items-center justify-center size-8 rounded hover:bg-bg-secondary transition-colors text-foreground">
<span class="material-symbols-outlined text-[20px]">search</span>
</button>
<button aria-label="Settings" class="flex items-center justify-center size-8 rounded hover:bg-bg-secondary transition-colors text-foreground">
<span class="material-symbols-outlined text-[20px]">text_fields</span>
</button>
</div>
</div>
</header>
<!-- Main Content Layout -->
<main class="flex-1 flex justify-center w-full relative">
<div class="w-full max-w-[1440px] flex flex-row">
<!-- Left Rail: Table of Contents -->
<aside class="hidden lg:flex w-[240px] flex-col sticky top-14 h-[calc(100vh-3.5rem)] border-r border-border overflow-y-auto pt-12 pb-10 pl-10 pr-6">
<nav class="flex flex-col gap-8">
<div>
<h4 class="font-mono text-xs uppercase tracking-widest text-muted mb-4">Contents</h4>
<ul class="flex flex-col gap-3 font-mono text-[13px] leading-relaxed">
<li>
<a class="text-foreground hover:text-accent transition-colors flex items-start gap-2 group" href="#theoretical-foundations">
<span class="text-accent font-medium opacity-0 group-hover:opacity-100 transition-opacity absolute -left-4">→</span>
                                    Theoretical Foundations
                                </a>
</li>
<li>
<a class="text-foreground hover:text-accent transition-colors flex items-start gap-2 group" href="#technical-implementation">
<span class="text-accent font-medium opacity-0 group-hover:opacity-100 transition-opacity absolute -left-4">→</span>
                                    Technical Implementation
                                </a>
</li>
<li>
<a class="text-foreground hover:text-accent transition-colors flex items-start gap-2 group" href="#real-world-applications">
<span class="text-accent font-medium opacity-0 group-hover:opacity-100 transition-opacity absolute -left-4">→</span>
                                    Real-World Applications
                                </a>
</li>
<li>
<a class="text-foreground hover:text-accent transition-colors flex items-start gap-2 group" href="#optimization-strategies">
<span class="text-accent font-medium opacity-0 group-hover:opacity-100 transition-opacity absolute -left-4">→</span>
                                    Optimization Strategies
                                </a>
</li>
<li>
<a class="text-foreground hover:text-accent transition-colors flex items-start gap-2 group" href="#evaluation-framework">
<span class="text-accent font-medium opacity-0 group-hover:opacity-100 transition-opacity absolute -left-4">→</span>
                                    Evaluation Framework
                                </a>
</li>
</ul>
</div>
<div class="mt-auto pt-8 border-t border-border">
<div class="flex flex-col gap-2">
<span class="font-mono text-[11px] uppercase tracking-widest text-muted">Progress</span>
<div class="w-full bg-bg-secondary h-1 rounded-full overflow-hidden">
<div class="bg-primary h-full w-[35%]"></div>
</div>
<span class="font-mono text-xs text-foreground text-right">35%</span>
</div>
</div>
</nav>
</aside>
<!-- Center Stage: The Reader -->
<article class="flex-1 max-w-[720px] mx-auto pt-16 pb-32 px-6 md:px-12 min-h-screen">
<!-- Module Header -->
<header class="mb-16 border-b border-border pb-12">
<div class="flex items-center gap-3 mb-6">
<span class="font-mono text-sm font-medium text-accent px-2 py-1 bg-primary/10 rounded">Module 01</span>
<span class="font-mono text-sm text-muted">Advanced RAG Architectures</span>
</div>
<h1 class="font-display text-[48px] md:text-[56px] leading-[1.1] font-semibold text-foreground tracking-tight mb-6">
                        Reranking Strategies
                    </h1>
<p class="font-serif text-xl text-foreground/80 leading-relaxed max-w-[90%]">
                        Understanding the trade-offs between bi-encoders and cross-encoders in modern information retrieval pipelines.
                    </p>
</header>
<!-- Content Body -->
<div class="prose-academic">
<h2 id="theoretical-foundations">1. Advanced Theoretical Foundations</h2>
<h3>The Mathematical Basis of Reranking</h3>
<p>
Reranking operates on the principle of <strong>multi-stage retrieval optimization</strong>. Unlike single-stage retrieval that relies on cosine similarity in embedding space, reranking introduces a <strong>relevance refinement layer</strong>:
</p>

<div class="mermaid-diagram">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 300">
  <!-- Simple representation of the reranking process -->
  <rect x="20" y="20" width="100" height="40" fill="#f0f0f0" stroke="#ccc" />
  <text x="70" y="45" font-size="14" text-anchor="middle">Query</text>
  
  <line x1="120" y1="40" x2="160" y2="40" stroke="#333" marker-end="url(#arrow)" />
  
  <rect x="160" y="20" width="100" height="40" fill="#e0e0e0" stroke="#ccc" />
  <text x="210" y="45" font-size="14" text-anchor="middle">Embedding</text>
  
  <line x1="260" y1="40" x2="300" y2="40" stroke="#333" marker-end="url(#arrow)" />
  
  <rect x="300" y="20" width="100" height="40" fill="#d0e0f0" stroke="#ccc" />
  <text x="350" y="45" font-size="14" text-anchor="middle">Vector Search</text>
  
  <line x1="400" y1="40" x2="440" y2="40" stroke="#333" marker-end="url(#arrow)" />
  
  <rect x="440" y="20" width="100" height="40" fill="#f0e0d0" stroke="#ccc" />
  <text x="490" y="45" font-size="14" text-anchor="middle">Top K</text>
  
  <line x1="490" y1="60" x2="490" y2="120" stroke="#333" marker-end="url(#arrow)" />
  <line x1="70" y1="60" x2="70" y2="120" stroke="#333" marker-end="url(#arrow)" />
  
  <rect x="300" y="120" width="160" height="40" fill="#f0d0f0" stroke="#ccc" />
  <text x="380" y="145" font-size="14" text-anchor="middle">Cross-Encoder Reranker</text>
  
  <line x1="380" y1="160" x2="380" y2="200" stroke="#333" marker-end="url(#arrow)" />
  
  <rect x="330" y="200" width="100" height="40" fill="#e0f0d0" stroke="#ccc" />
  <text x="380" y="225" font-size="14" text-anchor="middle">Sorted Results</text>
  
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#333" />
    </marker>
  </defs>
</svg>
</div>

<p><strong>First Stage: Broad Recall</strong><br>
<code class="bg-bg-secondary px-1 rounded-sm text-sm font-code">Query → Embedding → Vector Search → Top-K candidates (K=50-100)</code></p>

<p><strong>Second Stage: Precision Filtering</strong><br>
<code class="bg-bg-secondary px-1 rounded-sm text-sm font-code">Query + Candidates → Cross-Encoder → Relevance Scores → Top-M results (M=5-10)</code></p>

<h3>Cross-Encoder vs. Bi-Encoder Architecture</h3>
<div class="not-prose my-12 border border-border bg-bg-secondary rounded-sm overflow-hidden">
<div class="flex items-center justify-between px-4 py-2 border-b border-border bg-[#e6dfd1]">
<span class="font-mono text-xs text-foreground">architecture_comparison.py</span>
<div class="flex gap-2">
<span class="text-[10px] font-mono text-muted uppercase">Python</span>
<button class="text-muted hover:text-accent transition-colors" onclick="copyCode(this)">
<span class="material-symbols-outlined text-[16px]">content_copy</span>
</button>
</div>
</div>
<div class="p-5 overflow-x-auto">
<pre class="font-code text-[13px] leading-6"><code class="language-python"><span class="token comment"># Bi-Encoder (Traditional Semantic Search)</span>
query_embedding = encoder(query)
doc_embedding = encoder(document)
similarity = cosine_similarity(query_embedding, doc_embedding)

<span class="token comment"># Cross-Encoder (Reranking)</span>
combined_input = <span class="token string">"[CLS] "</span> + query + <span class="token string">" [SEP] "</span> + document + <span class="token string">" [SEP]"</span>
combined_embedding = encoder(combined_input)
relevance_score = classification_head(combined_embedding)</code></pre>
</div>
</div>

<p><strong>Critical Differences:</strong></p>
<ul class="list-disc pl-6 my-6">
<li><strong>Bi-encoders</strong>: Pre-computable, fast, but limited to embedding similarity.</li>
<li><strong>Cross-encoders</strong>: Compute-intensive, but capture nuanced query-document interactions.</li>
</ul>

<h2 id="technical-implementation">2. Extended Technical Implementation</h2>
<h3>Advanced Code Implementation with Multiple Reranking Options</h3>
<div class="not-prose my-12 border border-border bg-bg-secondary rounded-sm overflow-hidden">
<div class="flex items-center justify-between px-4 py-2 border-b border-border bg-[#e6dfd1]">
<span class="font-mono text-xs text-foreground">advanced_reranker.py</span>
<div class="flex gap-2">
<span class="text-[10px] font-mono text-muted uppercase">Python</span>
<button class="text-muted hover:text-accent transition-colors" onclick="copyCode(this)">
<span class="material-symbols-outlined text-[16px]">content_copy</span>
</button>
</div>
</div>
<div class="p-5 overflow-x-auto">
<pre class="font-code text-[13px] leading-6"><code class="language-python"><span class="token keyword">import</span> torch
<span class="token keyword">from</span> transformers <span class="token keyword">import</span> AutoTokenizer, AutoModelForSequenceClassification
<span class="token keyword">from</span> sentence_transformers <span class="token keyword">import</span> CrossEncoder
<span class="token keyword">from</span> typing <span class="token keyword">import</span> List, Dict
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token keyword">class</span> <span class="token class-name">AdvancedReranker</span>:
    <span class="token keyword">def</span> <span class="token function">__init__</span>(self, model_name<span class="token punctuation">:</span> str <span class="token operator">=</span> <span class="token string">"cross-encoder/ms-marco-MiniLM-L-6-v2"</span><span class="token punctuation">)</span>:
        self<span class="token punctuation">.</span>model <span class="token operator">=</span> CrossEncoder<span class="token punctuation">(</span>model_name<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>device <span class="token operator">=</span> torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">"cuda"</span> <span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">"cpu"</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">rerank_with_confidence</span>(
        self, query<span class="token punctuation">:</span> str, candidates<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span>, top_k<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">10</span>, score_threshold<span class="token punctuation">:</span> float <span class="token operator">=</span> <span class="token number">0.5</span>
    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span>:
        <span class="token triple-quoted-string string">"""
        Rerank candidates with confidence scoring and thresholding
        """</span>
        <span class="token comment"># Prepare sentence pairs for cross-encoder</span>
        sentence_pairs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>query, candidate<span class="token punctuation">[</span><span class="token string">"text"</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token keyword">for</span> candidate <span class="token keyword">in</span> candidates<span class="token punctuation">]</span>

        <span class="token comment"># Get similarity scores</span>
        similarity_scores <span class="token operator">=</span> self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>sentence_pairs<span class="token punctuation">)</span>

        <span class="token comment"># Enhance candidates with scores and metadata</span>
        <span class="token keyword">for</span> idx, candidate <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>candidates<span class="token punctuation">)</span>:
            candidate<span class="token punctuation">[</span><span class="token string">"relevance_score"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>similarity_scores<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">)</span>
            candidate<span class="token punctuation">[</span><span class="token string">"confidence"</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>_calculate_confidence<span class="token punctuation">(</span>similarity_scores<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">)</span>
            candidate<span class="token punctuation">[</span><span class="token string">"reranked_position"</span><span class="token punctuation">]</span> <span class="token operator">=</span> idx

        <span class="token comment"># Filter by threshold and sort</span>
        filtered_candidates <span class="token operator">=</span> <span class="token punctuation">[</span>
            candidate <span class="token keyword">for</span> candidate <span class="token keyword">in</span> candidates
            <span class="token keyword">if</span> candidate<span class="token punctuation">[</span><span class="token string">"relevance_score"</span><span class="token punctuation">]</span> <span class="token operator">>=</span> score_threshold
        <span class="token punctuation">]</span>

        <span class="token comment"># Sort by relevance score</span>
        filtered_candidates<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token string">"relevance_score"</span><span class="token punctuation">]</span>, reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> filtered_candidates<span class="token punctuation">[</span><span class="token punctuation">:</span>top_k<span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">_calculate_confidence</span>(self, score<span class="token punctuation">:</span> float) <span class="token operator">-</span><span class="token operator">></span> str:
        <span class="token triple-quoted-string string">"""Calculate confidence level based on score"""</span>
        <span class="token keyword">if</span> score <span class="token operator">>=</span> <span class="token number">0.8</span>:
            <span class="token keyword">return</span> <span class="token string">"high"</span>
        <span class="token keyword">elif</span> score <span class="token operator">>=</span> <span class="token number">0.5</span>:
            <span class="token keyword">return</span> <span class="token string">"medium"</span>
        <span class="token keyword">else</span>:
            <span class="token keyword">return</span> <span class="token string">"low"</span>

    <span class="token keyword">def</span> <span class="token function">batch_rerank</span>(
        self,
        queries<span class="token punctuation">:</span> List<span class="token punctuation">[</span>str<span class="token punctuation">]</span>,
        candidates_list<span class="token punctuation">:</span> List<span class="token punctuation">[</span>List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">]</span>,
        batch_size<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">32</span>
    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span>List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">]</span>:
        <span class="token triple-quoted-string string">"""Batch processing for multiple queries"""</span>
        results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span>, <span class="token builtin">len</span><span class="token punctuation">(</span>queries<span class="token punctuation">)</span>, batch_size<span class="token punctuation">)</span>:
            batch_queries <span class="token operator">=</span> queries<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i<span class="token operator">+</span>batch_size<span class="token punctuation">]</span>
            batch_candidates <span class="token operator">=</span> candidates_list<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i<span class="token operator">+</span>batch_size<span class="token punctuation">]</span>

            batch_results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> query, candidates <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>batch_queries, batch_candidates<span class="token punctuation">)</span>:
                reranked <span class="token operator">=</span> self<span class="token punctuation">.</span>rerank_with_confidence<span class="token punctuation">(</span>query, candidates<span class="token punctuation">)</span>
                batch_results<span class="token punctuation">.</span>append<span class="token punctuation">(</span>reranked<span class="token punctuation">)</span>

            results<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>batch_results<span class="token punctuation">)</span>

        <span class="token keyword">return</span> results</code></pre>
</div>
</div>

<h2 id="real-world-applications">3. Advanced Real-World Applications</h2>
<h3>Healthcare: Clinical Decision Support System</h3>
<p>
In healthcare applications, reranking systems must account for patient-specific contexts and safety considerations. The following example demonstrates how to enhance a reranking system with medical domain knowledge:
</p>

<div class="not-prose my-12 border border-border bg-bg-secondary rounded-sm overflow-hidden">
<div class="flex items-center justify-between px-4 py-2 border-b border-border bg-[#e6dfd1]">
<span class="font-mono text-xs text-foreground">medical_reranking.py</span>
<div class="flex gap-2">
<span class="text-[10px] font-mono text-muted uppercase">Python</span>
<button class="text-muted hover:text-accent transition-colors" onclick="copyCode(this)">
<span class="material-symbols-outlined text-[16px]">content_copy</span>
</button>
</div>
</div>
<div class="p-5 overflow-x-auto">
<pre class="font-code text-[13px] leading-6"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">MedicalRerankingSystem</span>:
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span>:
        self<span class="token punctuation">.</span>general_reranker <span class="token operator">=</span> AdvancedReranker<span class="token punctuation">(</span><span class="token string">"cross-encoder/ms-marco-MiniLM-L-6-v2"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>medical_reranker <span class="token operator">=</span> AdvancedReranker<span class="token punctuation">(</span><span class="token string">"models/medical-reranker"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>specialty_models <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">"cardiology"</span><span class="token punctuation">:</span> AdvancedReranker<span class="token punctuation">(</span><span class="token string">"models/cardiology-reranker"</span><span class="token punctuation">)</span>,
            <span class="token string">"oncology"</span><span class="token punctuation">:</span> AdvancedReranker<span class="token punctuation">(</span><span class="token string">"models/oncology-reranker"</span><span class="token punctuation">)</span>,
            <span class="token string">"neurology"</span><span class="token punctuation">:</span> AdvancedReranker<span class="token punctuation">(</span><span class="token string">"models/neurology-reranker"</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">rerank_medical_query</span><span class="token punctuation">(</span>self, query<span class="token punctuation">:</span> str, patient_context<span class="token punctuation">:</span> Dict, candidates<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span>:
        <span class="token triple-quoted-string string">"""Advanced medical reranking with patient context"""</span>
        <span class="token comment"># Enhance query with patient context</span>
        enhanced_query <span class="token operator">=</span> self<span class="token punctuation">.</span>_enhance_medical_query<span class="token punctuation">(</span>query, patient_context<span class="token punctuation">)</span>
        <span class="token comment"># Determine medical specialty</span>
        specialty <span class="token operator">=</span> self<span class="token punctuation">.</span>_detect_specialty<span class="token punctuation">(</span>enhanced_query<span class="token punctuation">)</span>
        <span class="token comment"># Select appropriate reranker</span>
        reranker <span class="token operator">=</span> self<span class="token punctuation">.</span>specialty_models<span class="token punctuation">.</span>get<span class="token punctuation">(</span>specialty, self<span class="token punctuation">.</span>medical_reranker<span class="token punctuation">)</span>
        <span class="token comment"># Apply specialty-specific thresholds</span>
        threshold <span class="token operator">=</span> self<span class="token punctuation">.</span>_get_specialty_threshold<span class="token punctuation">(</span>specialty<span class="token punctuation">)</span>
        <span class="token comment"># Perform reranking</span>
        reranked_results <span class="token operator">=</span> reranker<span class="token punctuation">.</span>rerank_with_confidence<span class="token punctuation">(</span>
            enhanced_query,
            candidates,
            score_threshold<span class="token operator">=</span>threshold
        <span class="token punctuation">)</span>
        <span class="token comment"># Apply medical safety filters</span>
        filtered_results <span class="token operator">=</span> self<span class="token punctuation">.</span>_apply_medical_safety_filters<span class="token punctuation">(</span>reranked_results, patient_context<span class="token punctuation">)</span>
        <span class="token keyword">return</span> filtered_results</code></pre>
</div>
</div>

<h2 id="optimization-strategies">4. Performance Optimization Strategies</h2>
<h3>Latency Reduction Techniques</h3>
<p>
In production systems, reranking performance is critical. The following techniques can significantly reduce latency while maintaining accuracy:
</p>

<div class="not-prose my-12 border border-border bg-bg-secondary rounded-sm overflow-hidden">
<div class="flex items-center justify-between px-4 py-2 border-b border-border bg-[#e6dfd1]">
<span class="font-mono text-xs text-foreground">optimized_reranker.py</span>
<div class="flex gap-2">
<span class="text-[10px] font-mono text-muted uppercase">Python</span>
<button class="text-muted hover:text-accent transition-colors" onclick="copyCode(this)">
<span class="material-symbols-outlined text-[16px]">content_copy</span>
</button>
</div>
</div>
<div class="p-5 overflow-x-auto">
<pre class="font-code text-[13px] leading-6"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">OptimizedReranker</span>:
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self, model_name<span class="token punctuation">:</span> str, optimization_level<span class="token punctuation">:</span> str <span class="token operator">=</span> <span class="token string">"balanced"</span><span class="token punctuation">)</span>:
        self<span class="token punctuation">.</span>model <span class="token operator">=</span> CrossEncoder<span class="token punctuation">(</span>model_name<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>optimization_level <span class="token operator">=</span> optimization_level

    <span class="token keyword">def</span> <span class="token function">optimized_rerank</span><span class="token punctuation">(</span>self, query<span class="token punctuation">:</span> str, candidates<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span>:
        <span class="token triple-quoted-string string">"""Optimized reranking with various latency reduction techniques"""</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>optimization_level <span class="token operator">==</span> <span class="token string">"speed"</span>:
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_fast_rerank<span class="token punctuation">(</span>query, candidates<span class="token punctuation">)</span>
        <span class="token keyword">elif</span> self<span class="token punctuation">.</span>optimization_level <span class="token operator">==</span> <span class="token string">"balanced"</span>:
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_balanced_rerank<span class="token punctuation">(</span>query, candidates<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>  <span class="token comment"># "accuracy"</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_accurate_rerank<span class="token punctuation">(</span>query, candidates<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">_fast_rerank</span><span class="token punctuation">(</span>self, query<span class="token punctuation">:</span> str, candidates<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span>:
        <span class="token triple-quoted-string string">"""Speed-optimized reranking"""</span>
        <span class="token comment"># Pre-filter candidates using cheap methods</span>
        pre_filtered <span class="token operator">=</span> self<span class="token punctuation">.</span>_pre_filter_candidates<span class="token punctuation">(</span>query, candidates<span class="token punctuation">)</span>
        <span class="token comment"># Use smaller batch sizes</span>
        batch_size <span class="token operator">=</span> <span class="token number">8</span>
        results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span>, <span class="token builtin">len</span><span class="token punctuation">(</span>pre_filtered<span class="token punctuation">)</span>, batch_size<span class="token punctuation">)</span>:
            batch <span class="token operator">=</span> pre_filtered<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i<span class="token operator">+</span>batch_size<span class="token punctuation">]</span>
            sentence_pairs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>query, candidate<span class="token punctuation">[</span><span class="token string">"text"</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token keyword">for</span> candidate <span class="token keyword">in</span> batch<span class="token punctuation">]</span>
            scores <span class="token operator">=</span> self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>sentence_pairs, batch_size<span class="token operator">=</span>batch_size<span class="token punctuation">)</span>
            <span class="token keyword">for</span> j, candidate <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>batch<span class="token punctuation">)</span>:
                candidate<span class="token punctuation">[</span><span class="token string">"relevance_score"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>scores<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
            results<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>batch<span class="token punctuation">)</span>
        results<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token string">"relevance_score"</span><span class="token punctuation">]</span>, reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> results<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span>  <span class="token comment"># Return fewer results for speed</span>

    <span class="token keyword">def</span> <span class="token function">_pre_filter_candidates</span><span class="token punctuation">(</span>self, query<span class="token punctuation">:</span> str, candidates<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span>:
        <span class="token triple-quoted-string string">"""Pre-filter using cheap similarity measures"""</span>
        query_terms <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span>query<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        filtered <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> candidate <span class="token keyword">in</span> candidates:
            candidate_terms <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span>candidate<span class="token punctuation">[</span><span class="token string">"text"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            overlap <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>query_terms<span class="token punctuation">.</span>intersection<span class="token punctuation">(</span>candidate_terms<span class="token punctuation">)</span><span class="token punctuation">)</span>
            jaccard_similarity <span class="token operator">=</span> overlap <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>query_terms<span class="token punctuation">.</span>union<span class="token punctuation">(</span>candidate_terms<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> jaccard_similarity <span class="token operator">></span> <span class="token number">0.1</span><span class="token punctuation">:</span>  <span class="token comment"># Threshold for pre-filtering</span>
                filtered<span class="token punctuation">.</span>append<span class="token punctuation">(</span>candidate<span class="token punctuation">)</span>
        <span class="token keyword">return</span> filtered</code></pre>
</div>
</div>

<h2 id="evaluation-framework">5. Evaluation Framework for Reranking</h2>
<p>
Evaluating reranking systems requires specialized metrics that go beyond traditional retrieval evaluation. Key metrics include:
</p>
<ul class="list-disc pl-6 my-6">
<li><strong>NDCG (Normalized Discounted Cumulative Gain)</strong>: Measures the quality of ranking based on graded relevance judgments</li>
<li><strong>MRR (Mean Reciprocal Rank)</strong>: Evaluates the rank of the first relevant document</li>
<li><strong>Recall@K</strong>: Proportion of relevant documents retrieved in the top K positions</li>
<li><strong>Hit Rate</strong>: Percentage of queries for which at least one relevant document appears in the top K results</li>
</ul>

<h2 id="production-deployment">6. Production Deployment Considerations</h2>
<h3>Scalability Architecture</h3>
<p>
Deploying reranking systems at scale requires careful consideration of computational resources and latency requirements. The following architecture demonstrates a scalable approach:
</p>

<div class="mermaid-diagram">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 400">
  <!-- Simple sequence diagram representation -->
  <rect x="20" y="20" width="100" height="40" fill="#f0f0f0" stroke="#ccc" />
  <text x="70" y="45" font-size="14" text-anchor="middle">User</text>
  
  <rect x="150" y="20" width="100" height="40" fill="#e0e0e0" stroke="#ccc" />
  <text x="200" y="45" font-size="14" text-anchor="middle">Service</text>
  
  <rect x="280" y="20" width="100" height="40" fill="#d0e0f0" stroke="#ccc" />
  <text x="330" y="45" font-size="14" text-anchor="middle">Cache</text>
  
  <rect x="410" y="20" width="100" height="40" fill="#f0e0d0" stroke="#ccc" />
  <text x="460" y="45" font-size="14" text-anchor="middle">Model</text>
  
  <line x1="70" y1="60" x2="200" y2="100" stroke="#333" marker-end="url(#arrow)" />
  <text x="135" y="85" font-size="12" text-anchor="middle">Batch Requests</text>
  
  <line x1="200" y1="100" x2="200" y2="140" stroke="#333" marker-end="url(#arrow)" />
  <text x="220" y="120" font-size="12" text-anchor="start">Group by Query</text>
  
  <line x1="200" y1="140" x2="330" y2="160" stroke="#333" marker-end="url(#arrow)" />
  <text x="265" y="155" font-size="12" text-anchor="middle">Check Cache</text>
  
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#333" />
    </marker>
  </defs>
</svg>
</div>

</div>
<!-- Footer / Pagination -->
<div class="mt-24 pt-10 border-t border-border flex justify-between items-center group/footer">
<a class="flex flex-col items-start gap-2 hover:bg-bg-secondary/50 p-4 -ml-4 rounded transition-colors w-1/2 opacity-50 cursor-not-allowed" href="#">
<span class="font-mono text-xs text-muted uppercase tracking-wider">Previous Module</span>
<span class="font-display text-lg font-medium text-foreground flex items-center gap-2">
<span class="material-symbols-outlined text-[18px]">arrow_back</span>
                            Introduction
                        </span>
</a>
<div class="h-12 w-px bg-faded mx-4"></div>
<a class="flex flex-col items-end gap-2 hover:bg-bg-secondary/50 p-4 -mr-4 rounded transition-colors w-1/2" href="module_02_chunking_strategies.html">
<span class="font-mono text-xs text-muted uppercase tracking-wider">Next Module</span>
<span class="font-display text-lg font-medium text-foreground flex items-center gap-2">
                            Chunking Strategies
                            <span class="material-symbols-outlined text-[18px]">arrow_forward</span>
</span>
</a>
</div>
</article>
<!-- Right Rail: Marginalia -->
<aside class="hidden xl:block w-[240px] sticky top-14 h-[calc(100vh-3.5rem)] pt-32 pb-10 pr-10 pl-4 overflow-y-auto">
<div class="flex flex-col gap-24 relative">
<!-- Note 1: Aligned with theoretical foundations -->
<div class="relative group cursor-pointer transition-transform hover:-translate-x-1">
<div class="absolute -left-3 top-1 text-[10px] font-bold text-accent font-mono">[1]</div>
<p class="font-mono text-[12px] leading-5 text-muted group-hover:text-foreground transition-colors">
<strong class="text-foreground">Multi-stage retrieval</strong> is essential for balancing recall and precision in large-scale systems.
                        </p>
</div>
<!-- Note 2: Aligned with technical implementation -->
<div class="relative group cursor-pointer transition-transform hover:-translate-x-1 mt-12">
<div class="absolute -left-3 top-1 text-[10px] font-bold text-accent font-mono">[2]</div>
<p class="font-mono text-[12px] leading-5 text-muted group-hover:text-foreground transition-colors">
<strong class="text-foreground">Cross-encoders</strong> provide superior accuracy but at higher computational cost compared to bi-encoders.
                        </p>
<a class="inline-flex items-center gap-1 mt-2 text-[10px] uppercase tracking-widest text-accent font-bold hover:underline" href="artifact_view.html" target="_blank">
                            View Code <span class="material-symbols-outlined text-[10px]">open_in_new</span>
</a>
</div>
<!-- Note 3: Aligned with optimization strategies -->
<div class="relative group cursor-pointer transition-transform hover:-translate-x-1 mt-24">
<div class="absolute -left-3 top-1 text-[10px] font-bold text-accent font-mono">[3]</div>
<p class="font-mono text-[12px] leading-5 text-muted group-hover:text-foreground transition-colors">
                            In production systems, <code class="bg-bg-secondary px-0.5 rounded-sm">pre-filtering</code> can significantly reduce computational overhead.
                        </p>
</div>
<!-- Additional marginalia for module-specific content -->
<div class="relative group cursor-pointer transition-transform hover:-translate-x-1 mt-16">
<div class="absolute -left-3 top-1 text-[10px] font-bold text-accent font-mono">[4]</div>
<p class="font-mono text-[12px] leading-5 text-muted group-hover:text-foreground transition-colors">
                            <strong class="text-foreground">Score calibration</strong> ensures relevance scores are comparable across different queries.
                        </p>
</div>
<div class="relative group cursor-pointer transition-transform hover:-translate-x-1 mt-16">
<div class="absolute -left-3 top-1 text-[10px] font-bold text-accent font-mono">[5]</div>
<p class="font-mono text-[12px] leading-5 text-muted group-hover:text-foreground transition-colors">
                            <strong class="text-foreground">Domain-specific reranking</strong> can dramatically improve performance in specialized applications.
                        </p>
</div>
</div>
</aside>
</div>
</main>

<script>
    // Function to copy code to clipboard
    function copyCode(button) {
        const codeBlock = button.closest('.not-prose').querySelector('pre code');
        navigator.clipboard.writeText(codeBlock.textContent.trim()).then(() => {
            const originalIcon = button.querySelector('.material-symbols-outlined').textContent;
            button.querySelector('.material-symbols-outlined').textContent = 'check';
            setTimeout(() => {
                button.querySelector('.material-symbols-outlined').textContent = originalIcon;
            }, 2000);
        });
    }

    // Calculate reading time based on content
    document.addEventListener('DOMContentLoaded', function() {
        const content = document.querySelector('.prose-academic').textContent;
        const wordsPerMinute = 200; // Average reading speed
        const wordCount = content.split(/\s+/).length;
        const readingTime = Math.ceil(wordCount / wordsPerMinute);
        
        document.getElementById('reading-time').textContent = `${readingTime} min read`;
    });

    // Search button functionality
    document.getElementById('search-btn').addEventListener('click', function() {
        window.location.href = 'search_index.html';
    });
</script>
</body></html>